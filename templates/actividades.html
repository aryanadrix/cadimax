{% extends "base.html" %}
{% block conteudo %}

<style>
body {
  background-color: #f5f5f5;
}

/* Container principal */
.container-actividades {
  background: #fff;
  border-radius: 8px;
  padding: 25px;
  margin: 30px auto;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
  max-width: 1200px;
}

/* Título da seção */
.titulo-secao {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}
.titulo-secao span {
  font-size: 16px;
  color: #222;
  font-weight: 600;
}
.titulo-secao .linha {
  flex: 1;
  height: 2px;
  background: var(--cor-principal, #fb6e2b);
  border-radius: 2px;
}

/* Últimas 3 atividades */
.ultimas-atividades {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}
.card-mini {
  flex: 1 1 calc(33.333% - 20px);
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.3s ease;
}
.card-mini:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
}
.card-mini img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.card-mini .conteudo {
  padding: 12px;
}
.card-mini small {
  display: block;
  color: #777;
  font-size: 12px;
  margin-bottom: 2px;
}
.card-mini h5 {
  color: var(--cor-principal, #fb6e2b);
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 6px;
}
.card-mini p {
  color: #444;
  font-size: 14px;
  line-height: 1.4;
  text-align: justify;
  margin: 0;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Atividades antigas */
.card-atividade {
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  transition: 0.3s;
  cursor: pointer;
}
.card-atividade:hover {
  transform: translateY(-6px);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
}
.card-atividade img {
  width: 100%;
  height: 220px;
  object-fit: cover;
}
.card-atividade .conteudo {
  padding: 15px;
}
.card-atividade .titulo {
  font-weight: 700;
  color: #222;
  font-size: 17px;
}
.card-atividade:hover .titulo {
  color: var(--cor-principal, #fb6e2b);
}
.card-atividade .data {
  color: #777;
  font-size: 13px;
  margin-bottom: 4px;
  line-height: 1.2;
}
.card-atividade .corpo {
  color: #444;
  font-size: 14px;
  text-align: justify;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Modal Detalhes */
.modal-content {
  border-radius: 10px;
}
.modal-header {
  background: var(--cor-principal, #fb6e2b);
  color: #fff;
}
.modal-header .btn-close {
  filter: invert(1);
}
.modal-body {
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;
}
</style>

<div class="container-actividades">
  <div class="titulo-secao">
    <span>Últimas atividades registadas</span>
    <span class="linha"></span>
  </div>

  <!-- 3 últimas atividades -->
  <div class="ultimas-atividades">
    {% for p in posts[:3] %}
    <div class="card-mini" onclick="abrirModal('{{ p.id }}')">
      <img src="{{ p.foto or url_for('static', filename='img/default.jpg') }}" alt="Imagem">
      <div class="conteudo">
        <small>Publicado em {{ p.data_publicacao.strftime('%d/%m/%Y') }}</small>
        <small>Atividade: {{ p.data_atividade }}</small>
        <h5>{{ p.titulo }}</h5>
        <p>{{ p.corpo[:100] }}...</p>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Atividades antigas -->
  <div class="row g-3">
    {% for p in posts[3:] %}
    <div class="col-md-4">
      <div class="card-atividade" onclick="abrirModal('{{ p.id }}')">
        <img src="{{ p.foto or url_for('static', filename='img/default.jpg') }}" alt="">
        <div class="conteudo">
          <div class="data">
            Publicado em {{ p.data_publicacao.strftime('%d/%m/%Y') }}<br>
            Atividade: {{ p.data_atividade }}
          </div>
          <div class="titulo">{{ p.titulo }}</div>
          <div class="corpo">{{ p.corpo[:150] }}...</div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="text-center text-muted">Nenhuma atividade registada ainda.</div>
    {% endfor %}
  </div>
</div>

<!-- Modal Detalhes -->
<div class="modal fade" id="detModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detTitulo"></h5>
        <button type="button" class="btn-close" onclick="history.back()" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <img id="detFoto" src="" alt="" class="img-fluid rounded mb-3" style="max-height:300px; width:100%; object-fit:cover;">
        <p class="mb-1"><b>Data da Publicação:</b> <span id="detPublicacao"></span></p>
        <p class="mb-2"><b>Data da Atividade:</b> <span id="detAtividade"></span></p>
        <div id="detCorpo" style="max-height:300px; overflow-y:auto;"></div>
      </div>
    </div>
  </div>
</div>

<script>
async function abrirModal(id){
  const r = await fetch(`/admin/actividades/${id}/json`);
  const d = await r.json();
  document.getElementById('detTitulo').textContent = d.titulo;
  document.getElementById('detFoto').src = d.foto || "{{ url_for('static', filename='img/default.jpg') }}";
  document.getElementById('detPublicacao').textContent = new Date(d.data_publicacao || Date.now()).toLocaleDateString('pt-PT');
  document.getElementById('detAtividade').textContent = d.data_atividade || 'Não especificada';
  document.getElementById('detCorpo').textContent = d.corpo || '';
  new bootstrap.Modal(document.getElementById('detModal')).show();
}
</script>

{% endblock %}